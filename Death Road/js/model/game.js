export default class Game{constructor(a,b,c,d){this.main=a,this.view=b;const e=50;this._LEFT_ARROW_KEYCODE=37,this._UP_ARROW_KEYCODE=38,this._RIGHT_ARROW_KEYCODE=39,this._DOWN_ARROW_KEYCODE=40,this._isLeftPressed=!1,this._isUpPressed=!1,this._isRightPressed=!1,this._isBottomPressed=!1;class f{constructor(a,b,c,d,e){this.xPos=a,this.yPos=b,this.width=c,this.height=d,this.color=e}}this._field=new class extends f{}(0,0,c,d,"lightgray");this._road=new class extends f{}(0,d-250,c,200,"gray");this._river=new class extends f{}(0,d-500,c,200,"blue");this._finishRow=new class extends f{}(0,d-600,c,100,"red");class g{constructor(a,b,c,d){this.xPos=a,this.yPos=b,this.radius=c,this.color=d,this.width=2*c,this.height=2*c}}this._finishZones=[];let h=25;for(let e,f=0;5>f;f++)e=125*f+h+25,this._finishZones[f]=new g(e,d-550-1+25,h,"lightgreen");this._frog=new class extends f{constructor(a,b,c,d,e,f,g,h){super(a,b,c,d,e),this.step=f,this.takes=g,this.points=h}moveLeft(){this.xPos-=this.step}moveForward(){this.yPos-=this.step}moveRight(){this.xPos+=this.step}moveBack(){this.yPos+=this.step}resetPosition(){this.xPos=.5*c-.25*e,this.yPos=d-.75*e}}(.5*c-.25*50,d-.75*50+1,25,25,"green",50,3,0);class j extends f{constructor(a,b,c,d,e,f){super(a,b,c,d,e),this.speed=f}}this._cars=[];let k=0;for(let e=0;2>e;e++)this._cars[k]=new j(250*e,d-100+6,100,38,this.generateColor(),1),k++;for(let e=0;2>e;e++)this._cars[k]=new j(300*e,d-150+6,100,38,this.generateColor(),2),k++;for(let f=0;2>f;f++)this._cars[k]=new j(300*f,d-200+6,e,38,this.generateColor(),-3),k++;for(let e=0;2>e;e++)this._cars[k]=new j(350*e,d-250+6,125,38,this.generateColor(),-1),k++;class l extends j{}this._logs=[];let m=0;for(let e=0;3>e;e++)this._logs[m]=new l(250*e,d-350+2,150,46,"SaddleBrown",1),m++;for(let e=0;2>e;e++)this._logs[m]=new l(350*e,d-400+2,50,46,"SaddleBrown",-3),m++;for(let e=0;2>e;e++)this._logs[m]=new l(350*e,d-450+2,150,46,"SaddleBrown",2),m++;for(let e=0;3>e;e++)this._logs[m]=new l(225*e,d-500+2,100,46,"SaddleBrown",-1),m++;this.view.update(this._field,this._road,this._river,this._finishRow,this._finishZones,this._cars,this._logs,this._frog),this.view.updateScore(this._frog),this.changeCarPosition(this._field,this._road,this._river,this._finishRow,this._finishZones,this._cars,this._logs,this._frog)}generateColor(){return`#${Math.floor(16777215*Math.random()).toString(16)}`}keydownHandler(a){a.keyCode!==this._LEFT_ARROW_KEYCODE||this._isLeftPressed||(a.preventDefault(),this._isLeftPressed=!0,this._frog.moveLeft()),a.keyCode!==this._UP_ARROW_KEYCODE||this._isUpPressed||(a.preventDefault(),this._isUpPressed=!0,this._frog.moveForward()),a.keyCode!==this._RIGHT_ARROW_KEYCODE||this._isRightPressed||(a.preventDefault(),this._isRightPressed=!0,this._frog.moveRight()),a.keyCode!==this._DOWN_ARROW_KEYCODE||this._isBottomPressed||(a.preventDefault(),this._isBottomPressed=!0,this._frog.moveBack()),this.checkFrogPosition(this._field,this._road,this._river,this._finishRow,this._finishZones,this._cars,this._logs,this._frog)}keyupHandler(a){switch(a.keyCode){case this._LEFT_ARROW_KEYCODE:this._isLeftPressed=!1;break;case this._UP_ARROW_KEYCODE:this._isUpPressed=!1;break;case this._RIGHT_ARROW_KEYCODE:this._isRightPressed=!1;break;case this._DOWN_ARROW_KEYCODE:this._isBottomPressed=!1;}}checkFrogPosition(a,b,c,d,e,f,g,h){let i=a.xPos,j=a.xPos+a.width,k=a.yPos,l=a.yPos+a.height,m=h.xPos,n=h.xPos+h.width,o=h.yPos,p=h.yPos+h.height;o<k&&(h.yPos=k+.75*50),p>l&&(h.yPos=l-.75*50),m<i&&(h.xPos=i),n>j&&(h.xPos=j-h.width);for(let i of f)this.hasIntersection(h,i)&&(i.color="red",h.resetPosition(),1<h.takes?h.takes--:this.main.showResult(h.points),this.view.updateScore(h));if(this.hasIntersection(h,c)){let a=!1;for(let b of g)this.hasIntersection(h,b)&&(a=!0,h.xPos+=b.speed);a||(h.resetPosition(),1<h.takes?h.takes--:this.main.showResult(h.points),this.view.updateScore(h))}if(this.hasIntersection(h,d)){let a=!1;for(let b of e)this.hasIntersection(h,b)&&"red"!==b.color&&(a=!0,h.xPos=b.xPos-b.radius/2,h.yPos=b.yPos-b.radius/2,h.points+=10,b.color="red",h.resetPosition(),this.view.updateScore(h)),e.every(a=>"red"===a.color)&&(e=e.map(a=>a.color="lightgreen"),f=f.map(a=>0<a.speed?a.speed+=.5:a.speed-=.5),g=g.map(a=>0<a.speed?a.speed+=.5:a.speed-=.5));a||(h.resetPosition(),1<h.takes?h.takes--:this.main.showResult(h.points),this.view.updateScore(h))}this.view.update(a,b,c,d,e,f,g,h)}hasIntersection(a,b){let c=a.xPos,d=a.xPos+a.width,e=a.yPos,f=a.yPos+a.height,g=b.xPos,h=b.xPos+b.width,i=b.yPos,j=b.yPos+b.height;return!(c>=h||d<=g||e>=j||f<=i)}changeCarPosition(a,b,c,d,e,f,g,h){for(let i of f)i.xPos+=i.speed,i.leftWheelX+=i.speed,i.rightWheelX+=i.speed,i.windScreenX+=i.speed,i.xPos>a.width&&(i.color=this.generateColor(),i.xPos=a.xPos-i.width),i.xPos<a.xPos-i.width&&(i.color=this.generateColor(),i.xPos=a.width);for(let i of g)i.xPos+=i.speed,i.xPos>a.width&&(i.xPos=a.xPos-i.width),i.xPos<a.xPos-i.width&&(i.xPos=a.width);this.view.update(a,b,c,d,e,f,g,h),this.checkFrogPosition(a,b,c,d,e,f,g,h),requestAnimationFrame(this.changeCarPosition.bind(this,a,b,c,d,e,f,g,h))}}